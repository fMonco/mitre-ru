




Создание или изменение системного процесса
==========================================================


Злоумышленники могут создавать или модифицировать процессы системного уровня для многократного выполнения вредоносной полезной нагрузки в рамках персистенции. Когда операционные системы загружаются, они могут запускать процессы, выполняющие фоновые функции системы. В Windows и Linux эти системные процессы называются сервисами. В macOS процессы launchd, известные как Launch Daemon и Launch Agent, запускаются для завершения инициализации системы и загрузки специфических для пользователя параметров.

Злоумышленники могут устанавливать новые службы, демоны или агенты, которые могут быть настроены на выполнение при запуске или через повторяющийся интервал времени, чтобы обеспечить постоянство. Аналогичным образом злоумышленники могут модифицировать существующие службы, демоны или агенты для достижения того же эффекта.

Службы, демоны или агенты могут быть созданы с правами администратора, но выполняться под правами root/SYSTEM. Злоумышленники могут использовать эту функциональность для создания или модификации системных процессов с целью повышения привилегий.




Агент запуска
-------------------------------------------------


Злоумышленники могут создавать или модифицировать агенты запуска для многократного выполнения вредоносных полезных нагрузок в рамках персистентности. При входе пользователя в систему запускается пользовательский процесс launchd, который загружает параметры для каждого агента запуска по требованию из файла списка свойств (.plist), находящегося в /System/Library/LaunchAgents, /Library/LaunchAgents и ~/Library/LaunchAgents.  Файлы списка свойств используют ключи Label, ProgramArguments и RunAtLoad для определения имени агента запуска, местоположения исполняемого файла и времени выполнения. Агенты запуска часто устанавливаются для выполнения обновлений программ, запуска программ, указанных пользователем при входе в систему, или для выполнения других задач разработчика.

Агенты запуска также могут быть выполнены с помощью команды Launchctl.

Злоумышленники могут установить новый агент запуска, который запускается при входе в систему, поместив файл .plist в соответствующие папки с ключами RunAtLoad или KeepAlive, установленными на true. Имя агента запуска может быть замаскировано, используя имя из соответствующей операционной системы или недоброкачественного программного обеспечения. Агенты запуска создаются с привилегиями уровня пользователя и выполняются с правами уровня пользователя.




Служба Systemd
-------------------------------------------------


Злоумышленники могут создавать или модифицировать службы systemd для многократного выполнения вредоносной полезной нагрузки в рамках персистенции. Systemd - это менеджер систем и сервисов, используемый для управления фоновыми процессами демонов (также известных как сервисы) и другими системными ресурсами. Systemd является системой инициализации (init) по умолчанию во многих дистрибутивах Linux, заменяя устаревшие системы инициализации, включая SysVinit и Upstart, сохраняя при этом обратную совместимость.

Systemd использует файлы конфигурации модулей с расширением .service для кодирования информации о процессе службы. По умолчанию файлы модулей системного уровня хранятся в каталоге /systemd/system корневой директории (/). Файлы модулей пользовательского уровня хранятся в директории /systemd/user директории, принадлежащей пользователю ($HOME).




Служба Windows
-------------------------------------------------


Злоумышленники могут создавать или модифицировать службы Windows для многократного выполнения вредоносной полезной нагрузки в рамках персистенции. При загрузке Windows запускаются программы или приложения, называемые службами, которые выполняют фоновые функции системы. Информация о конфигурации служб Windows, включая путь к исполняемому файлу службы или программам/командам восстановления, хранится в реестре Windows.

Злоумышленники могут установить новую службу или модифицировать существующую, чтобы она выполнялась при запуске и сохранялась в системе. Конфигурации служб могут быть установлены или изменены с помощью системных утилит (например, sc.exe), путем прямого изменения реестра или непосредственного взаимодействия с Windows API.

Злоумышленники также могут использовать службы для установки и выполнения вредоносных драйверов. Например, после сброса файла драйвера (например, .sys) на диск полезная нагрузка может быть загружена и зарегистрирована с помощью функций Native API, таких как CreateServiceW, или с помощью утилит командной строки, таких как PnPUtil.exe. Злоумышленники могут использовать эти драйверы в качестве руткитов, чтобы скрыть наличие вредоносной активности в системе. Злоумышленники также могут загрузить подписанный, но уязвимый драйвер на взломанную машину (так называемый "Bring Your Own Vulnerable Driver" (BYOVD)) в рамках эксплойта для повышения привилегий.

Службы могут быть созданы с правами администратора, но выполняются под правами SYSTEM, поэтому злоумышленник может также использовать службу для повышения привилегий. Злоумышленники также могут напрямую запускать службы через Service Execution. Чтобы усложнить анализ обнаружения, вредоносные службы могут также использовать маскировку задач или служб (например, использовать имя службы и/или полезной нагрузки, связанное с легитимной ОС или компонентом доброкачественного ПО).
