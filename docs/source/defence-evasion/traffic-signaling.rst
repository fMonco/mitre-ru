

Traffic Signaling
========================

Злоумышленники могут использовать сигнализацию трафика, чтобы скрыть открытые порты или другие вредоносные функции, используемые для персистенции или управления. Сигнализация трафика подразумевает использование магического значения или последовательности, которые должны быть отправлены системе, чтобы вызвать специальную реакцию, например открытие закрытого порта или выполнение вредоносной задачи. Это может выражаться в отправке серии пакетов с определенными характеристиками до открытия порта, которые противник может использовать для управления и контроля. Обычно эта серия пакетов состоит из попыток подключения к заранее определенной последовательности закрытых портов (т. е. Port Knocking), но может включать необычные флаги, определенные строки или другие уникальные характеристики. После завершения последовательности открытие порта может быть выполнено брандмауэром на базе хоста, но может быть реализовано и пользовательским программным обеспечением.

Злоумышленники могут также взаимодействовать с уже открытым портом, но служба, прослушивающая этот порт, будет отвечать на команды или запускать другие вредоносные функции только в том случае, если ей будет передано соответствующее магическое значение (значения).

Наблюдение за сигнальными пакетами для запуска взаимодействия может осуществляться различными методами. Один из них, первоначально реализованный Cd00r =, заключается в использовании библиотек libpcap для обнаружения соответствующих пакетов. Другой метод использует "сырые" сокеты, что позволяет вредоносному ПО использовать порты, которые уже открыты для использования другими программами.

На сетевых устройствах злоумышленники могут использовать поддельные пакеты, чтобы включить аутентификацию сетевого устройства для стандартных служб, предлагаемых устройством, таких как telnet. Такие сигналы могут также использоваться для открытия закрытого служебного порта, например telnet, или для запуска модификации модулей вредоносных программ, установленных на устройстве, с добавлением, удалением или изменением вредоносных возможностей. Злоумышленники могут использовать поддельные пакеты для попытки подключения к одному или нескольким (открытым или закрытым) портам, но также могут попытаться подключиться к интерфейсу маршрутизатора, широковещательной рассылке и сетевому адресу IP на том же порту для достижения своих целей и задач.=== Чтобы задействовать эту сигнализацию трафика на встроенных устройствах, злоумышленники должны сначала получить и использовать образ системы исправления из-за монолитности архитектуры.

Злоумышленники также могут использовать функцию Wake-on-LAN для включения выключенных систем. Wake-on-LAN - это аппаратная функция, которая позволяет включить или разбудить выключенную систему, отправив ей магический пакет. После включения системы она может стать целью для латерального перемещения==.




Пробивание портов
----------------------------------------------------------------------------

Недоброжелатели могут использовать пробивку портов, чтобы скрыть открытые порты, используемые для сохранения или управления. Чтобы открыть порт, злоумышленник отправляет серию попыток подключения к заранее определенной последовательности закрытых портов. После завершения последовательности открытие порта часто выполняется брандмауэром на базе хоста, но может быть реализовано и пользовательским программным обеспечением.

Эта техника наблюдалась как при динамическом открытии прослушиваемого порта, так и при инициировании соединения с прослушивающим сервером на другой системе.

Наблюдение за сигнальными пакетами для запуска связи может осуществляться различными методами. Один из них, первоначально реализованный Cd00r =, заключается в использовании библиотек libpcap для прослушивания пакетов. Другой метод использует сырые сокеты, что позволяет вредоносному ПО использовать порты, которые уже открыты для использования другими программами.





Сокет фильтры
----------------------------------------------------------------------------

Злоумышленники могут подключать фильтры к сетевым сокетам, чтобы отслеживать и затем активировать бэкдоры, используемые для сохранения или управления. С повышенными правами злоумышленники могут использовать такие функции, как библиотека libpcap, для открытия сокетов и установки фильтров, разрешающих или запрещающих прохождение определенных типов данных через сокет. Фильтр может применяться ко всему трафику, проходящему через указанный сетевой интерфейс (или ко всем интерфейсам, если они не указаны). Когда сетевой интерфейс получает пакет, соответствующий критериям фильтра, на хосте могут быть запущены дополнительные действия, например, активация обратного командного интерпретатора.

Чтобы установить соединение, злоумышленник отправляет на целевой хост подготовленный пакет, соответствующий установленным критериям фильтра.= Злоумышленники использовали эти фильтры сокетов для установки имплантатов, проведения обратных пингов и вызова командных оболочек. Связь с помощью этих сокет-фильтров может также использоваться в сочетании с туннелированием протоколов.

Фильтры могут быть установлены на любой Unix-подобной платформе с установленной libpcap или на Windows-хостах с помощью Winpcap. Злоумышленники могут использовать либо libpcap с pcap_setfilter, либо функцию стандартной библиотеки setsockopt с опциями SO_ATTACH_FILTER. Поскольку сокетное соединение не активно до получения пакета, такое поведение может быть трудно обнаружить из-за отсутствия активности на хосте, низкой нагрузки на процессор и ограниченной видимости использования необработанных сокетов.



Выполнение прокси
============================

Злоумышленники могут использовать доверенные утилиты разработчиков для прокси-исполнения вредоносных полезных нагрузок. Существует множество утилит, используемых для разработки программного обеспечения, которые могут использоваться для выполнения кода в различных формах, чтобы помочь в разработке, отладке и обратном проектировании.==== Эти утилиты часто могут быть подписаны легитимными сертификатами, которые позволяют им работать в системе и проксировать выполнение вредоносного кода через доверенный процесс, который эффективно обходит решения по контролю приложений.



MSBuild
----------------------------------------------------------------------------

Злоумышленники могут использовать MSBuild для прокси-исполнения кода через доверенную утилиту Windows. MSBuild.exe (Microsoft Build Engine) - это платформа для сборки программного обеспечения, используемая Visual Studio. Она обрабатывает файлы проектов в формате XML, определяющие требования для загрузки и сборки различных платформ и конфигураций=.

Злоумышленники могут использовать MSBuild для прокси-исполнения вредоносного кода. Возможность встраивания задач в MSBuild, появившаяся в .NET версии 4, позволяет вставить код на C# или Visual Basic в XML-файл проекта.== MSBuild скомпилирует и выполнит встраиваемую задачу. MSBuild.exe - это подписанный двоичный файл Microsoft, поэтому при его использовании таким образом можно выполнить произвольный код и обойти защиту от контроля приложений, настроенную на разрешение выполнения MSBuild.exe.