

Манипуляции с учетными записями
==================================
Недоброжелатели могут манипулировать учетными записями, чтобы сохранить и/или расширить доступ к системам жертвы. Манипуляции с учетными записями могут включать в себя любые действия, сохраняющие или изменяющие доступ противника к взломанной учетной записи, например изменение учетных данных или групп разрешений. Эти действия также могут включать в себя действия с учетными записями, направленные на нарушение политик безопасности, например, итеративное обновление пароля для обхода политик длительности пароля и сохранения срока действия скомпрометированных учетных данных.

Чтобы создавать или манипулировать учетными записями, противник должен обладать достаточными правами на системы или домен. Однако манипуляции с учетными записями могут также привести к повышению привилегий, когда модификации предоставляют доступ к дополнительным ролям, разрешениям или действительным учетным записям с более высокими привилегиями.



Дополнительные облачные учетные данные
-------------------------------------------------

Злоумышленники могут добавлять контролируемые злоумышленниками учетные данные в облачную учетную запись, чтобы сохранить постоянный доступ к учетным записям и экземплярам жертвы в среде.

Например, злоумышленники могут добавлять учетные данные для Service Principals и Applications в дополнение к существующим законным учетным данным в Azure AD. Эти учетные данные включают как ключи x509, так и пароли. При наличии достаточных прав существует множество способов добавления учетных данных, включая Azure Portal, интерфейс командной строки Azure, а также модули Azure или Az PowerShell.

В средах инфраструктуры как услуги (IaaS) после получения доступа через облачные учетные записи злоумышленники могут генерировать или импортировать собственные SSH-ключи с помощью API CreateKeyPair или ImportKeyPair в AWS или команды gcloud compute os-login ssh-keys add в GCP. Это позволяет получить постоянный доступ к инстансам в облачной среде без дальнейшего использования скомпрометированных облачных учетных записей.



Дополнительные полномочия делегатов электронной почты
--------------------------------------------------------------

Недоброжелатели могут предоставлять дополнительные уровни разрешений, чтобы сохранить постоянный доступ к контролируемой ими учетной записи электронной почты.

Например, команда Add-MailboxPermission PowerShell, доступная в локальном Exchange и облачном сервисе Office 365, добавляет разрешения к почтовому ящику. В Google Workspace делегирование можно включить через консоль Google Admin, а пользователи могут делегировать учетные записи через настройки Gmail.

Злоумышленники также могут назначать разрешения на папки почтовых ящиков с помощью индивидуальных разрешений на папки или ролей. В средах Office 365 злоумышленники могут назначить разрешения или роли пользователей Default или Anonymous для папок Top of Information Store (root), Inbox или других почтовых ящиков. Назначив одно или оба пользовательских разрешения папке, злоумышленник может использовать любую другую учетную запись в арендаторе для поддержания постоянства почтовых папок целевого пользователя.



Дополнительные роли в облаке
-------------------------------------------------

Злоумышленник может добавить дополнительные роли или разрешения к контролируемой им учетной записи "облака", чтобы сохранить постоянный доступ к арендатору. Например, злоумышленники могут обновлять политики IAM в облачных средах или добавлять нового глобального администратора в средах Office 365. При наличии достаточных разрешений взломанная учетная запись может получить практически неограниченный доступ к данным и настройкам (включая возможность сбрасывать пароли других администраторов).

Модификация учетной записи может следовать сразу за созданием учетной записи или другими действиями злоумышленников. Злоумышленники также могут изменять существующие действительные учетные записи, которые они скомпрометировали. Это может привести к повышению привилегий, особенно если добавленные роли позволяют перемещаться к дополнительным учетным записям.

Например, в средах AWS злоумышленник с соответствующими полномочиями может использовать API CreatePolicyVersion для определения новой версии политики IAM или API AttachUserPolicy для прикрепления политики IAM с дополнительными или отличными полномочиями к скомпрометированной учетной записи пользователя.


Авторизованные ключи SSH
-------------------------------------------------

Злоумышленники могут модифицировать файл SSH authorized_keys, чтобы сохранить его на хосте-жертве. Дистрибутивы Linux и macOS обычно используют аутентификацию на основе ключей для защиты процесса аутентификации в сеансах SSH для удаленного управления. Файл authorized_keys в SSH определяет ключи SSH, которые могут использоваться для входа в учетную запись пользователя, для которого этот файл настроен. Этот файл обычно находится в домашней директории пользователя в каталоге <user-home>/.ssh/authorized_keys. Пользователи могут отредактировать файл конфигурации SSH системы и изменить директивы PubkeyAuthentication и RSAAuthentication на значение "yes", чтобы обеспечить включение аутентификации с открытым ключом и RSA. Файл конфигурации SSH обычно находится в каталоге /etc/ssh/sshd_config.

Злоумышленники могут напрямую изменять файлы SSH authorized_keys с помощью скриптов или команд командной оболочки, чтобы добавить свои собственные открытые ключи, предоставленные противником. В облачных средах злоумышленники могут изменять файл SSH authorized_keys конкретной виртуальной машины через интерфейс командной строки или rest API. Например, с помощью команды "add-metadata" в Google Cloud CLI противник может добавить SSH-ключи к учетной записи пользователя. Аналогично, в Azure противник может обновить файл authorized_keys виртуальной машины с помощью PATCH-запроса к API.  Это гарантирует, что противник, обладающий соответствующим закрытым ключом, сможет войти в систему как существующий пользователь через SSH. Это также может привести к повышению привилегий, когда виртуальная машина или экземпляр имеют права, отличные от прав запрашивающего пользователя.

