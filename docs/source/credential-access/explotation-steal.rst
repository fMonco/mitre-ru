

Эксплуатация для доступа к учетным данным
----------------------------------------------------------------------------

Злоумышленники могут использовать уязвимости в программном обеспечении, пытаясь получить учетные данные. Эксплуатация программной уязвимости происходит, когда противник использует ошибку в программе, службе или в самом программном обеспечении или ядре операционной системы для выполнения контролируемого противником кода. 

Механизмы проверки подлинности и аутентификации могут стать мишенью для эксплуатации злоумышленниками в качестве средства получения доступа к полезным учетным данным или обхода процесса получения аутентифицированного доступа к системам. Одним из примеров этого является MS14-068, который нацелен на Kerberos и может быть использован для подделки билетов Kerberos с использованием прав пользователей домена. Другим примером являются атаки повтора, при которых противник перехватывает пакеты данных, отправленные между сторонами, а затем воспроизводит эти пакеты. Если сервисы не проверяют запросы на аутентификацию должным образом, эти воспроизведенные пакеты могут позволить злоумышленнику выдать себя за одну из сторон и получить несанкционированный доступ или привилегии.

Подобная эксплуатация была продемонстрирована и в облачных средах. Например, злоумышленники использовали уязвимости в инфраструктуре публичного облака, которые позволяли непреднамеренно создавать и обновлять маркеры аутентификации.

Эксплуатация для получения доступа к учетным данным также может привести к повышению привилегий в зависимости от процесса или полученных учетных данных.



Принудительная аутентификация
----------------------------------------------------------------------------

Злоумышленники могут собирать учетные данные, вызывая или заставляя пользователя автоматически предоставлять информацию об аутентификации через механизм, который они могут перехватить.

Протокол Server Message Block широко используется в сетях Windows для аутентификации и связи между системами для доступа к ресурсам и совместного использования файлов. Когда система Windows пытается подключиться к ресурсу SMB, она автоматически пытается пройти аутентификацию и отправить информацию о текущем пользователе удаленной системе.  Такое поведение типично для корпоративных сред, так что пользователям не нужно вводить учетные данные для доступа к сетевым ресурсам.

Web Distributed Authoring and Versioning также обычно используется в системах Windows в качестве резервного протокола, когда SMB заблокирован или не работает. WebDAV является расширением HTTP и обычно работает через TCP-порты 80 и 443.  

Злоумышленники могут воспользоваться этим поведением, чтобы получить доступ к хэшам учетных записей пользователей через принудительную аутентификацию SMB/WebDAV. Противник может отправить пользователю вложение для копьеметания, содержащее ссылку на внешний сервер, контролируемый противником, или разместить специально созданный файл на пути навигации для привилегированных учетных записей или на общедоступном ресурсе, чтобы жертва(и) получила к нему доступ. Когда система пользователя получает доступ к недоверенному ресурсу, она пытается пройти аутентификацию и отправляет информацию, включая хешированные учетные данные пользователя, по протоколу SMB на сервер, контролируемый противником.  Имея доступ к хэшу учетных данных, противник может выполнить автономный взлом методом грубой силы, чтобы получить доступ к учетным данным в открытом тексте. 



Перехват многофакторной аутентификации
----------------------------------------------------------------------------

Злоумышленники могут использовать механизмы многофакторной аутентификации для получения доступа к учетным данным, которые могут быть использованы для доступа к системам, службам и сетевым ресурсам. Использование MFA рекомендуется и обеспечивает более высокий уровень безопасности, чем использование только имен пользователей и паролей, но организации должны знать о методах, которые могут быть использованы для перехвата и обхода этих механизмов безопасности.

Если для многофакторной аутентификации используется смарт-карта, то для получения пароля, связанного со смарт-картой при обычном использовании, необходимо использовать кейлоггер. Имея как вставленную карту, так и доступ к паролю смарт-карты, противник может подключиться к сетевому ресурсу с помощью зараженной системы, чтобы проксировать аутентификацию с помощью вставленного аппаратного маркера". 

Злоумышленники также могут использовать кейлоггер для аналогичной атаки на другие аппаратные токены, например RSA SecurID. Захват ввода маркера может обеспечить временный доступ, а также, возможно, позволить злоумышленникам надежно предсказывать будущие значения аутентификации. 

Другие методы MFA могут быть перехвачены и использованы противником для аутентификации. Обычно одноразовые коды отправляются через внесетевые каналы связи. Если устройство и/или услуга не защищены, они могут быть уязвимы для перехвата. Провайдеры услуг также могут быть объектом атаки: например, злоумышленник может скомпрометировать службу обмена SMS-сообщениями, чтобы украсть коды MFA, отправленные на телефоны пользователей.



Генерация запросов на многофакторную аутентификацию
----------------------------------------------------------------------------

Злоумышленники могут попытаться обойти механизмы многофакторной аутентификации и получить доступ к учетным записям путем генерации запросов MFA, отправляемых пользователям.

Недоброжелатели, обладающие учетными данными действительных учетных записей, могут не завершить процесс входа в систему, если у них нет доступа к механизмам 2FA или MFA, необходимым в качестве дополнительного контроля учетных данных и безопасности. Чтобы обойти эту проблему, злоумышленники могут злоупотреблять автоматической генерацией push-уведомлений для служб MFA, таких как Duo Push, Microsoft Authenticator, Okta или аналогичных служб, чтобы заставить пользователя предоставить доступ к своей учетной записи.

В некоторых случаях злоумышленники могут постоянно повторять попытки входа в систему, чтобы завалить пользователя MFA push-уведомлениями, SMS-сообщениями и телефонными звонками, что в итоге может привести к тому, что пользователь примет запрос на аутентификацию в ответ на "усталость от MFA".


Сетевой сниффинг
----------------------------------------------------------------------------

Злоумышленники могут прослушивать сетевой трафик, чтобы получить информацию о среде, включая материалы для аутентификации, передаваемые по сети. Сетевой сниффинг - это использование сетевого интерфейса системы для мониторинга или перехвата информации, передаваемой по проводному или беспроводному соединению. Злоумышленник может перевести сетевой интерфейс в беспорядочный режим для пассивного доступа к данным, проходящим по сети, или использовать разветвленные порты для перехвата большего объема данных.

Данные, перехваченные с помощью этой техники, могут включать учетные данные пользователя, особенно отправленные по небезопасному, незашифрованному протоколу. Техники отравления разрешения служб имен, такие как LLMNR/NBT-NS Poisoning и SMB Relay, также могут использоваться для перехвата учетных данных веб-сайтов, прокси-серверов и внутренних систем путем перенаправления трафика противнику.

Сетевой сниффинг также может раскрыть детали конфигурации, такие как запущенные службы, номера версий и другие сетевые характеристики, необходимые для последующих действий по латеральному перемещению и/или уклонению от защиты.

В "облачных" средах противники все еще могут использовать сервисы зеркалирования трафика для перехвата сетевого трафика виртуальных машин. Например, AWS Traffic Mirroring, GCP Packet Mirroring и Azure vTap позволяют пользователям определять определенные экземпляры для сбора трафика и определенные цели для отправки собранного трафика.  Часто большая часть этого трафика будет в открытом виде из-за использования завершения TLS на уровне балансировщика нагрузки для снижения нагрузки на шифрование и расшифровку трафика. Затем злоумышленник может использовать такие методы эксфильтрации, как Transfer Data to Cloud Account, чтобы получить доступ к прослушанному трафику.

На сетевых устройствах злоумышленники могут осуществлять перехват сети с помощью команд CLI сетевого устройства, таких как monitor capture.



Кража токена доступа к приложению
----------------------------------------------------------------------------

Злоумышленники могут украсть токены доступа к приложениям, чтобы получить учетные данные для доступа к удаленным системам и ресурсам.

Токены доступа к приложениям используются для выполнения авторизованных API-запросов от имени пользователя или сервиса и широко применяются в качестве способа доступа к ресурсам в облачных и контейнерных приложениях и программном обеспечении как услуга. OAuth - одна из широко распространенных реализаций, которая выдает токены пользователям для доступа к системам. Злоумышленники, похитившие API-токены учетных записей в облачных и контейнерных средах, могут получить доступ к данным и выполнять действия с правами этих учетных записей, что может привести к повышению привилегий и дальнейшей компрометации среды.

В средах Kubernetes процессы, запущенные внутри контейнера, взаимодействуют с сервером Kubernetes API с помощью токенов учетных записей служб. Если контейнер скомпрометирован, злоумышленник может украсть токен контейнера и таким образом получить доступ к командам Kubernetes API.

Кража токена также может произойти с помощью социальной инженерии, в этом случае для предоставления доступа может потребоваться действие пользователя. Приложение, желающее получить доступ к облачным сервисам или защищенным API, может получить доступ с помощью OAuth 2.0 через различные протоколы авторизации. Примером часто используемой последовательности является поток Authorization Code Grant от Microsoft. Маркер доступа OAuth позволяет стороннему приложению взаимодействовать с ресурсами, содержащими пользовательские данные, в соответствии с запросами приложения без получения учетных данных пользователя.

Злоумышленники могут использовать авторизацию OAuth, создав вредоносное приложение, предназначенное для предоставления доступа к ресурсам с помощью OAuth-токена целевого пользователя. Злоумышленнику необходимо завершить регистрацию своего приложения на сервере авторизации, например Microsoft Identity Platform с помощью Azure Portal, IDE Visual Studio, интерфейса командной строки, PowerShell или вызовов REST API. Затем он может отправить целевому пользователю Spearphishing Link, чтобы убедить его предоставить доступ к приложению. После предоставления маркера доступа OAuth приложение может получить потенциально долгосрочный доступ к функциям учетной записи пользователя с помощью Application Access Token.

Токены доступа приложений могут функционировать в течение ограниченного срока, что ограничивает время, в течение которого злоумышленник может использовать украденный токен. Однако в некоторых случаях злоумышленники могут также похищать токены обновления приложений, что позволяет им получать новые токены доступа без запроса пользователя.


Кража или подделка сертификатов аутентификации
----------------------------------------------------------------------------


Злоумышленники могут украсть или подделать сертификаты, используемые для проверки подлинности при доступе к удаленным системам или ресурсам. Цифровые сертификаты часто используются для подписи и шифрования сообщений и/или файлов. Сертификаты также используются в качестве материала для проверки подлинности. Например, сертификаты устройств Azure AD и сертификаты служб сертификации Active Directory привязываются к идентификатору и могут использоваться в качестве учетных данных для учетных записей домена.

Сертификаты проверки подлинности можно как украсть, так и подделать. Например, сертификаты AD CS могут быть украдены из зашифрованного хранилища, из неправильно размещенных файлов сертификатов или непосредственно из хранилища сертификатов Windows через различные криптографические API. При наличии соответствующих прав на регистрацию пользователи и/или машины в домене могут также запрашивать и/или вручную обновлять сертификаты в корпоративных центрах сертификации. В процессе регистрации определяются различные параметры и разрешения, связанные с сертификатом. Следует отметить, что значения расширенного использования ключей сертификата определяют варианты использования подписи, шифрования и аутентификации, а значения альтернативного имени субъекта сертификата определяют альтернативные имена владельца сертификата.

Злоупотребление сертификатами для аутентификации может привести к другим видам поведения, таким как Lateral Movement. Неправильная конфигурация сертификата может также создавать возможности для повышения привилегий, позволяя пользователям выдавать себя за привилегированные учетные записи или полномочия с помощью идентификационных данных, связанных с сертификатом. Эти злоупотребления могут также способствовать сохранению постоянства путем кражи или подделки сертификатов, которые могут использоваться в качестве действительных учетных записей в течение всего срока действия сертификата, несмотря на сброс пароля пользователя. Сертификаты аутентификации также могут быть украдены и подделаны для машинных учетных записей.

Злоумышленники, имеющие доступ к закрытым ключам сертификатов корневого ЦС, могут также установить постоянство путем подделки произвольных сертификатов аутентификации для домена жертвы. Злоумышленники могут также использовать сертификаты и связанные с ними службы для доступа к другим формам учетных данных, таким как билеты, выдающие золотые билеты или открытый текст NTLM.
Токены доступа приложений могут функционировать в течение ограниченного срока, что ограничивает время, в течение которого злоумышленник может использовать украденный токен. Однако в некоторых случаях злоумышленники могут также похищать токены обновления приложений, что позволяет им получать новые токены доступа без запроса пользователя.


Кража файлов cookie веб-сессии
----------------------------------------------------------------------------


Злоумышленник может украсть файлы cookie сеанса веб-приложения или службы и использовать их для получения доступа к веб-приложениям или интернет-сервисам в качестве аутентифицированного пользователя без использования учетных данных. Веб-приложения и сервисы часто используют сеансовые файлы cookie в качестве маркера аутентификации после того, как пользователь авторизовался на сайте.

Файлы cookie часто действуют в течение длительного периода времени, даже если веб-приложение активно не используется. Файлы cookie могут находиться на диске, в памяти процесса браузера и в сетевом трафике удаленных систем. Кроме того, другие приложения на целевой машине могут хранить в памяти конфиденциальные файлы cookie для аутентификации. Сеансовые cookie-файлы могут использоваться для обхода некоторых протоколов многофакторной аутентификации.

Существует несколько примеров вредоносного ПО, использующего куки веб-браузеров в локальной системе. Существуют также фреймворки с открытым исходным кодом, такие как Evilginx2 и Muraena, которые могут собирать сеансовые куки через вредоносный прокси, который может быть создан противником и использоваться в фишинговых кампаниях.

После того как злоумышленник получает действительный файл cookie, он может использовать технику Web Session Cookie для входа в соответствующее веб-приложение.