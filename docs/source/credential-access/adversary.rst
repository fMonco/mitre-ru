



Adversary-in-the-Middle


Противник пытается украсть имена учетных записей и пароли.

Доступ к учетным данным состоит из методов кражи учетных данных, таких как имена учетных записей и пароли. Методы, используемые для получения учетных данных, включают в себя кейлоггинг или сброс учетных данных. Использование законных учетных данных может дать злоумышленникам доступ к системам, затруднить их обнаружение и дать возможность создать больше учетных записей для достижения своих целей.



Отравление LLMNR/NBT-NS и ретрансляция SMB
----------------------------------------------------------------------------

Отвечая на сетевой трафик LLMNR/NBT-NS, злоумышленники могут подделать авторитетный источник для разрешения имен, чтобы принудительно установить связь с системой, контролируемой противником. Эта деятельность может быть использована для сбора или передачи материалов для аутентификации.

Link-Local Multicast Name Resolution и NetBIOS Name Service - это компоненты Microsoft Windows, которые служат альтернативными методами идентификации хостов. LLMNR основана на формате системы доменных имен и позволяет узлам, находящимся на одном локальном канале связи, выполнять разрешение имен для других узлов. NBT-NS идентифицирует системы в локальной сети по их NetBIOS-имени. 

Злоумышленники могут подделать авторитетный источник разрешения имен в сети жертвы, отвечая на трафик LLMNR/NBT-NS так, как будто им известна личность запрашиваемого узла, эффективно отравляя службу, чтобы жертвы общались с системой, контролируемой злоумышленниками. Если запрашиваемый узел принадлежит ресурсу, требующему идентификации/аутентификации, имя пользователя и хэш NTLMv2 будут отправлены в систему, контролируемую злоумышленником. Затем противник может собрать информацию о хэше, отправленную по проводу, с помощью инструментов, отслеживающих трафик на портах, или с помощью сетевого сниффинга и взломать хэши в автономном режиме с помощью грубой силы, чтобы получить пароли в открытом виде.

В некоторых случаях, когда противник имеет доступ к системе, находящейся на пути аутентификации между системами, или когда автоматическое сканирование, использующее учетные данные, пытается аутентифицироваться в системе, контролируемой противником, хэши NTLMv1/v2 могут быть перехвачены и переданы для доступа и выполнения кода против целевой системы. Этап ретрансляции может происходить вместе с отравлением, но может быть и независимым от него. Кроме того, злоумышленники могут инкапсулировать хэши NTLMv1/v2 в различные протоколы, такие как LDAP, SMB, MSSQL и HTTP, чтобы расширить и использовать множество сервисов с действительным ответом NTLM.



Отравление кэша ARP
----------------------------------------------------------------------------

Злоумышленники могут отравлять кэш протокола разрешения адресов, чтобы занять позицию между двумя или более сетевыми устройствами. Эта деятельность может быть использована для последующего поведения, такого как сетевой сниффинг или манипулирование передаваемыми данными.

Протокол ARP используется для преобразования адресов IPv4 в адреса канального уровня, такие как MAC-адреса. Устройства в локальном сегменте сети взаимодействуют друг с другом, используя адреса канального уровня. Если сетевое устройство не имеет адреса канального уровня конкретного сетевого устройства, оно может послать широковещательный ARP-запрос в локальную сеть для преобразования IP-адреса в MAC-адрес. Устройство с соответствующим IP-адресом напрямую отвечает своим MAC-адресом. Сетевое устройство, отправившее ARP-запрос, будет использовать и хранить эту информацию в своем ARP-кэше.

Противник может пассивно ждать ARP-запроса, чтобы отравить ARP-кэш запрашивающего устройства. Противник может ответить своим MAC-адресом, тем самым обманув жертву и заставив ее поверить, что она общается с предполагаемым сетевым устройством. Чтобы злоумышленник смог отравить ARP-кэш, его ответ должен быть быстрее, чем ответ законного владельца IP-адреса. Злоумышленники также могут отправлять безвозмездные ARP-ответы, которые злонамеренно объявляют о владении определенным IP-адресом всем устройствам в локальном сегменте сети.

Протокол ARP не имеет статусов и не требует аутентификации. Поэтому устройства могут ошибочно добавлять или обновлять MAC-адрес IP-адреса в своем ARP-кэше.

Злоумышленники могут использовать отравление ARP-кэша как средство перехвата сетевого трафика. Эта активность может использоваться для сбора и/или передачи данных, например учетных данных, особенно отправленных по небезопасному, незашифрованному протоколу.



Подмена DHCP
----------------------------------------------------------------------------

Злоумышленники могут перенаправлять сетевой трафик на принадлежащие противнику системы, подменяя трафик протокола динамической конфигурации хоста и выступая в роли вредоносного DHCP-сервера в сети жертвы. Занимая позицию "противник посередине", злоумышленники могут собирать сетевые сообщения, включая переданные учетные данные, особенно те, которые отправляются по небезопасным, незашифрованным протоколам. Это также может привести к последующим действиям, таким как сетевой сниффинг или манипуляция передаваемыми данными.

DHCP основан на клиент-серверной модели и имеет две функции: протокол для предоставления параметров конфигурации сети от DHCP-сервера клиенту и механизм для выделения сетевых адресов клиентам. Типичное взаимодействие сервера и клиента происходит следующим образом:

 #. Клиент передает сообщение DISCOVER.

#. Сервер отвечает сообщением OFFER, которое содержит доступный сетевой адрес.

#. Клиент передает сообщение REQUEST, содержащее предложенный сетевой адрес.

#. Сервер подтверждает сообщение ACK, и клиент получает параметры конфигурации сети.

Недоброжелатели могут подделаться под неавторизованный DHCP-сервер в сети жертвы, от которого легитимные узлы могут получать вредоносные сетевые конфигурации. Например, вредоносное ПО может выступать в роли DHCP-сервера и предоставлять принадлежащие противнику DNS-серверы на пострадавшие компьютеры. С помощью вредоносных сетевых конфигураций противник может достичь позиции AiTM, направить клиентский трафик через контролируемые противником системы и собрать информацию из клиентской сети.

Клиенты DHCPv6 могут получать информацию о конфигурации сети без назначения IP-адреса, отправляя сообщение INFORMATION-REQUEST на многоадресный адрес All_DHCP_Relay_Agents_and_Servers. Противники могут использовать свой неавторизованный DHCP-сервер для ответа на это сообщение запроса с вредоносными конфигурациями сети.

Вместо создания позиции AiTM противники могут использовать подмену DHCP для атаки на исчерпание DHCP, генерируя множество широковещательных сообщений DISCOVER, чтобы исчерпать пул распределения DHCP в сети.