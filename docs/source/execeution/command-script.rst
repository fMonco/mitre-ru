



Интерпретатор команд и сценариев
=========================================================

Злоумышленники могут использовать командные интерпретаторы и интерпретаторы сценариев для выполнения команд, сценариев или двоичных файлов. Эти интерфейсы и языки предоставляют способы взаимодействия с компьютерными системами и являются общими для различных платформ.

Большинство систем поставляется со встроенным интерфейсом командной строки и возможностями написания сценариев. Например, дистрибутивы macOS и Linux включают в себя Unix Shell, а Windows - Windows Command Shell и PowerShell.Существуют также кроссплатформенные интерпретаторы, такие как Python, а также те, которые обычно ассоциируются с клиентскими приложениями, например JavaScript и Visual Basic.

Злоумышленники могут по-разному использовать эти технологии для выполнения произвольных команд. Команды и сценарии могут быть встроены в полезную нагрузку начального доступа, доставляемую жертвам в виде документов-приманок, или в качестве вторичной полезной нагрузки, загружаемой с существующего C2. Злоумышленники также могут выполнять команды через интерактивные терминалы/оболочки, а также использовать различные удаленные службы для удаленного выполнения.



PowerShell
------------------------------------------------------------------------

Злоумышленники могут использовать команды и сценарии PowerShell для выполнения. PowerShell - это мощный интерактивный интерфейс командной строки и среда создания сценариев, входящая в состав операционной системы Windows. Злоумышленники могут использовать PowerShell для выполнения ряда действий, включая поиск информации и выполнение кода.

В качестве примера можно привести команду Start-Process, которая используется для запуска исполняемого файла, и команду Invoke-Command, которая запускает команду локально или на удаленном компьютере (хотя для использования PowerShell для подключения к удаленным системам требуются права администратора).

PowerShell также можно использовать для загрузки и запуска исполняемых файлов из Интернета, которые могут быть выполнены с диска или в памяти без обращения к диску.Существует ряд инструментов для тестирования атак на базе PowerShell, включая Empire, PowerSploit, PoshC2 и PSAttack.

Команды/скрипты PowerShell также могут выполняться без прямого вызова двоичного файла powershell.exe через интерфейсы к базовой DLL-сборке PowerShell System.Management.Automation, доступные через фреймворк .NET и интерфейс общего языка Windows (CLI).



Оболочка Unix
------------------------------------------------------------------------

Злоумышленники могут злоупотреблять командами и сценариями оболочки Unix для выполнения. Оболочки Unix являются основным командным интерпретатором в системах Linux и macOS, хотя существует множество разновидностей оболочки Unix (например, sh, bash, zsh и т. д.) в зависимости от конкретной ОС или дистрибутива. Оболочки Unix могут контролировать все аспекты системы, при этом некоторые команды требуют повышенных привилегий.

Оболочки Unix также поддерживают скрипты, которые обеспечивают последовательное выполнение команд, а также другие типичные операции программирования, такие как условные сигналы и циклы. Обычно сценарии оболочки используются при выполнении длительных или повторяющихся задач, а также при необходимости запускать один и тот же набор команд на нескольких системах.

Злоумышленники могут использовать оболочки Unix для выполнения различных команд или полезной нагрузки. Доступ к интерактивным оболочкам может быть получен через командные каналы управления или при боковом перемещении, например с помощью SSH. Злоумышленники также могут использовать сценарии оболочки для доставки и выполнения нескольких команд на жертвах или в составе полезной нагрузки, используемой для сохранения.



Командная оболочка Windows
------------------------------------------------------------------------

Злоумышленники могут использовать командную оболочку Windows для выполнения команд. Командная оболочка Windows (cmd) - это основной командный интерпретатор в системах Windows. Командная строка Windows может использоваться для управления практически любыми аспектами системы, при этом для различных подгрупп команд требуются различные уровни разрешений. Командный интерпретатор можно вызывать удаленно через удаленные службы, например SSH.

Пакетные файлы (например, .bat или .cmd) также предоставляют оболочке список последовательных команд для выполнения, а также обычные скриптовые операции, такие как условия и циклы. Обычно пакетные файлы используются для выполнения длительных или повторяющихся задач, а также для запуска одного и того же набора команд на нескольких системах.

Злоумышленники могут использовать cmd для выполнения различных команд и полезной нагрузки. Обычно cmd используется для выполнения одной команды или для интерактивного использования cmd с вводом и выводом данных по командному каналу управления.


Python
------------------------------------------------------------------------

Злоумышленники могут использовать команды и скрипты Python для выполнения. Python - очень популярный язык сценариев/программирования, способный выполнять множество функций. Python может выполняться интерактивно из командной строки (через интерпретатор python.exe) или с помощью скриптов (.py), которые можно писать и распространять по различным системам. Код Python также может быть скомпилирован в двоичные исполняемые файлы.

Python поставляется с множеством встроенных пакетов для взаимодействия с базовой системой, например, файловых операций и ввода-вывода устройств. Злоумышленники могут использовать эти библиотеки для загрузки и выполнения команд или других скриптов, а также для выполнения различных вредоносных действий.



Облачный API
------------------------------------------------------------------------

Злоумышленники могут использовать облачные API для выполнения вредоносных команд. API, доступные в облачных средах, предоставляют различные функциональные возможности и являются многофункциональным методом для программного доступа практически ко всем аспектам деятельности арендатора. Эти API можно использовать с помощью различных методов, таких как интерпретаторы командной строки (CLI), браузерные облачные оболочки, модули PowerShell, например Azure for PowerShell, или комплекты разработчика программного обеспечения (SDK), доступные для таких языков, как Python.

Функции облачного API могут предоставлять административный доступ ко всем основным службам арендатора, таким как вычисления, хранение, управление идентификацией и доступом (IAM), сети и политики безопасности.

При наличии соответствующих разрешений злоумышленники могут использовать облачные API для вызова различных функций, выполняющих вредоносные действия. Например, доступ к функциям CLI и PowerShell можно получить с помощью двоичных файлов, установленных на хостингах "облачных" или локальных узлов, или через браузерную "облачную" оболочку, предлагаемую многими "облачными" платформами (такими как AWS, Azure и GCP). Эти облачные оболочки часто представляют собой упакованную унифицированную среду для использования модулей CLI и/или сценариев, размещенных в облачной среде в виде контейнера.