





Механизм управления повышением уровня злоупотребления
========================================================================

Злоумышленники могут обходить механизмы, предназначенные для контроля повышения привилегий, чтобы получить разрешения более высокого уровня. Большинство современных систем содержат встроенные механизмы контроля повышения привилегий, предназначенные для ограничения привилегий, которые пользователь может выполнять на машине. Для выполнения задач, которые могут быть отнесены к категории повышенного риска, необходимо предоставить полномочия определенным пользователям. Противник может использовать несколько методов, чтобы воспользоваться встроенными механизмами контроля для повышения привилегий в системе.




Sudo и Sudo Caching
----------------------------------------------------------------------------

Злоумышленники могут выполнять кэширование sudo и/или использовать файл sudoers для повышения привилегий. Злоумышленники могут выполнять команды от имени других пользователей или порождать процессы с более высокими привилегиями.

В системах Linux и MacOS команда sudo (иногда называемая "superuser do") позволяет пользователям выполнять команды с терминалов с повышенными привилегиями и контролировать, кто может выполнять эти команды в системе. Команда sudo "позволяет системному администратору делегировать полномочия, чтобы дать определенным пользователям (или группам пользователей) возможность выполнять некоторые (или все) команды от имени root или другого пользователя, обеспечивая при этом аудиторский след команд и их аргументов." Поскольку sudo была создана для системного администратора, она имеет некоторые полезные функции настройки, такие как timestamp_timeout, который представляет собой количество времени в минутах между экземплярами sudo, прежде чем она будет повторно запрашивать пароль. Это связано с тем, что sudo имеет возможность кэшировать учетные данные в течение определенного периода времени. Для определения этого таймаута Sudo создает (или трогает) файл в /var/db/sudo с меткой времени, когда sudo был запущен в последний раз. Кроме того, существует переменная tty_tickets, которая рассматривает каждый новый tty (терминальную сессию) изолированно. Это означает, что, например, таймаут sudo на одном tty не повлияет на другой tty (вам придется снова набирать пароль).

Файл sudoers, /etc/sudoers, описывает, какие пользователи могут выполнять какие команды и с каких терминалов. Здесь также описано, какие команды пользователи могут выполнять от имени других пользователей или групп. Это обеспечивает принцип наименьших привилегий, согласно которому пользователи большую часть времени работают с минимально возможными правами и повышаются до уровня других пользователей или прав только по мере необходимости, обычно запрашивая пароль. Однако в файле sudoers можно указать, когда не запрашивать у пользователей пароли, например user1 ALL=(ALL) NOPASSWD: ALL. Однако для редактирования этого файла требуются повышенные привилегии.



Повышенное выполнение с подсказкой
----------------------------------------------------------------------------

Злоумышленники могут использовать API AuthorizationExecuteWithPrivileges для повышения привилегий, запрашивая у пользователя учетные данные. Цель этого API - предоставить разработчикам приложений простой способ выполнения операций с привилегиями root, например, для установки или обновления приложений. Этот API не подтверждает, что программа, запрашивающая привилегии root, получена из надежного источника или была злонамеренно изменена.

Хотя этот API устарел, он по-прежнему полностью функционирует в последних выпусках macOS. При вызове этого API пользователю будет предложено ввести свои учетные данные, но никаких проверок происхождения или целостности программы не производится. Программа, вызывающая API, также может загружать файлы, доступные для записи в мире, которые могут быть модифицированы для выполнения вредоносного поведения с повышенными привилегиями.

Злоумышленники могут использовать AuthorizationExecuteWithPrivileges для получения привилегий root, чтобы установить вредоносное ПО на жертву и установить механизмы сохранения. Эта техника может быть объединена с Masquerading, чтобы обманом заставить пользователя предоставить повышенные привилегии вредоносному коду. Также было показано, что эта техника работает путем модификации легитимных программ, присутствующих на машине и использующих этот API.



Временный повышенный доступ к облаку
----------------------------------------------------------------------------

Злоумышленники могут злоупотреблять конфигурациями разрешений, позволяющими им получать временный повышенный доступ к облачным ресурсам. Многие облачные среды позволяют администраторам предоставлять учетным записям пользователей или служб разрешение запрашивать временный доступ к ролям, выдавать себя за другие учетные записи, передавать роли ресурсам и службам или иным образом получать кратковременный доступ к набору привилегий, которые могут отличаться от их собственных.

Доступ "точно в срок" - это механизм предоставления дополнительных ролей облачным учетным записям на гранулированной временной основе. Это позволяет учетным записям работать только с теми разрешениями, которые им необходимы на ежедневной основе, и запрашивать дополнительные разрешения по мере необходимости. Иногда запросы на доступ "точно в срок" настраиваются таким образом, чтобы требовать ручного одобрения, в то время как в других случаях необходимые разрешения предоставляются автоматически.

Имперсонация учетной записи позволяет учетным записям пользователей или служб временно действовать с разрешениями другой учетной записи. Например, в GCP пользователи с ролью iam.serviceAccountTokenCreator могут создавать временные маркеры доступа или подписывать произвольные полезные нагрузки с разрешениями учетной записи службы. В Exchange Online роль ApplicationImpersonation позволяет учетной записи службы использовать разрешения, связанные с указанными учетными записями пользователей.

Многие облачные среды также включают механизмы, позволяющие пользователям передавать роли ресурсам, которые позволяют им выполнять задачи и аутентифицироваться в других службах. Хотя пользователь, создающий ресурс, не принимает напрямую роль, которую он ему передает, он все равно может воспользоваться преимуществами доступа роли - например, настроить ресурс на выполнение определенных действий с предоставленными ему разрешениями. В AWS пользователи с разрешением PassRole могут разрешить создаваемому ими сервису принимать на себя заданную роль, а в GCP пользователи с ролью iam.serviceAccountUser могут прикрепить учетную запись сервиса к ресурсу.