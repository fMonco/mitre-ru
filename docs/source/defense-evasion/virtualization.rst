


Виртуализация/Уклонение от песочницы
============================================================================

Злоумышленники могут использовать различные средства для обнаружения и обхода сред виртуализации и анализа. Это может включать изменение поведения в зависимости от результатов проверки на наличие артефактов, указывающих на наличие среды виртуальной машины (VME) или песочницы. Если противник обнаруживает VME, он может изменить свое вредоносное ПО, чтобы отсоединиться от жертвы или скрыть основные функции имплантата. Они также могут искать артефакты VME перед тем, как сбросить вторую или дополнительную полезную нагрузку. Неприятели могут использовать информацию, полученную в ходе автоматического обнаружения Virtualization/Sandbox Evasion, для формирования последующего поведения.

Злоумышленники могут использовать несколько методов для выполнения Virtualization/Sandbox Evasion, например, проверять наличие инструментов мониторинга безопасности (например, Sysinternals, Wireshark и т. д.) или других системных артефактов, связанных с анализом или виртуализацией. Злоумышленники также могут проверять легитимную активность пользователя, чтобы определить, находится ли он в среде анализа. Дополнительные методы включают использование таймеров сна или циклов в коде вредоносного ПО, чтобы избежать работы во временной "песочнице"=.


Проверки системы
----------------------------------------------------------------------------

Злоумышленники могут использовать различные системные проверки для обнаружения и обхода сред виртуализации и анализа. Это может включать изменение поведения в зависимости от результатов проверки на наличие артефактов, указывающих на наличие среды виртуальной машины (VME) или песочницы. Если противник обнаруживает VME, он может изменить свое вредоносное ПО, чтобы отсоединиться от жертвы или скрыть основные функции имплантата. Они также могут искать артефакты VME перед тем, как сбросить вторую или дополнительную полезную нагрузку. Противники могут использовать информацию, полученную в ходе автоматического обнаружения Virtualization/Sandbox Evasion, для формирования последующего поведения=.

Конкретные проверки будут зависеть от цели и/или противника, но могут включать такие методы, как Windows Management Instrumentation, PowerShell, System Information Discovery и Query Registry для получения системной информации и поиска артефактов VME. Злоумышленники могут искать артефакты VME в памяти, процессах, файловой системе, оборудовании и/или реестре. Злоумышленники могут использовать сценарии для автоматизации этих проверок в одном сценарии, а затем заставить программу завершить работу, если она определит, что система является виртуальной средой.

Проверки могут включать общие свойства системы, такие как имя хоста/домена и образцы сетевого трафика. Злоумышленники также могут проверять адреса сетевых адаптеров, количество ядер процессора и объем доступной памяти/дисков.

Другие распространенные проверки могут включать перечисление запущенных служб, уникальных для этих приложений, установленных программ в системе, полей производителя/продукта для строк, относящихся к приложениям виртуальных машин, и специфических для VME инструкций оборудования/процессора.= В таких приложениях, как VMWare, злоумышленники могут также использовать специальный порт ввода/вывода для отправки команд и получения вывода.

Проверка аппаратного обеспечения, например наличие вентилятора, температуры и аудиоустройств, также может быть использована для сбора доказательств, указывающих на виртуальную среду. Злоумышленники также могут запрашивать определенные показания этих устройств=.


Проверки на основе активности пользователей
----------------------------------------------------------------------------

Злоумышленники могут использовать различные проверки действий пользователей для обнаружения и обхода сред виртуализации и анализа. Это может включать изменение поведения в зависимости от результатов проверки на наличие артефактов, указывающих на наличие среды виртуальной машины (VME) или песочницы. Если противник обнаруживает VME, он может изменить свое вредоносное ПО, чтобы отсоединиться от жертвы или скрыть основные функции имплантата. Кроме того, они могут искать артефакты VME, прежде чем сбросить вторую или дополнительную полезную нагрузку. Неприятели могут использовать информацию, полученную в ходе автоматизированного обнаружения Virtualization/Sandbox Evasion, для формирования последующего поведения=.

Злоумышленники могут искать активность пользователя на хосте на основе таких переменных, как скорость/частота движений мыши и щелчков =, история браузера, кэш, закладки или количество файлов в общих каталогах, таких как home или desktop. Другие методы могут зависеть от конкретного взаимодействия пользователя с системой до активации вредоносного кода, например, ожидание закрытия документа перед активацией макроса = или двойной щелчок на встроенном изображении=.


Уклонение, основанное на времени
----------------------------------------------------------------------------

Злоумышленники могут использовать различные методы, основанные на времени, для обнаружения и обхода сред виртуализации и анализа. Это может включать перечисление свойств, основанных на времени, таких как время работы или системные часы, а также использование таймеров или других триггеров, чтобы избежать среды виртуальной машины (VME) или песочницы, особенно тех, которые автоматизированы или работают только в течение ограниченного времени.

Злоумышленники могут использовать различные уловки, основанные на времени, например откладывать выполнение функций вредоносного ПО при первоначальном исполнении с помощью программных команд "сна" или встроенных системных функций планирования (например, Scheduled Task/Job). Задержки также могут быть основаны на ожидании выполнения определенных условий для жертвы (например, системного времени, событий и т. д.) или использовать запланированные многоступенчатые каналы, чтобы избежать анализа и проверки=.

Для задержки выполнения вредоносного ПО могут также использоваться доброкачественные команды или другие операции. Циклы или ненужные повторения команд, например Pings, могут использоваться для задержки выполнения вредоносного ПО и потенциального превышения временных порогов автоматизированных сред анализа.== Другой вариант, обычно называемый API hammering, включает в себя различные вызовы функций Native API с целью задержки выполнения (при этом потенциально перегружая среды анализа нежелательными данными).

Противники также могут использовать время как метрику для обнаружения песочниц и сред анализа, особенно тех, которые пытаются манипулировать временными механизмами для имитации больших промежутков времени. Например, злоумышленник может определить песочницу, ускоряющую время, путем выборки и вычисления ожидаемого значения временной метки среды до и после выполнения функции сна=.