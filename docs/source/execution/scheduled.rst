

Запланированная задача/работа
==============================================

Злоумышленники могут злоупотреблять функцией планирования задач, чтобы облегчить первоначальное или периодическое выполнение вредоносного кода. Во всех основных операционных системах существуют утилиты, позволяющие планировать выполнение программ или скриптов на определенную дату и время. Задачу также можно запланировать на удаленной системе при условии надлежащей аутентификации (например, RPC и совместное использование файлов и принтеров в среде Windows). Для планирования задачи на удаленной системе обычно требуется быть членом группы администраторов или другой привилегированной группы на удаленной системе.

Злоумышленники могут использовать планирование задач для выполнения программ при запуске системы или по расписанию для сохранения. Этими механизмами также можно злоупотреблять для запуска процесса в контексте определенной учетной записи (например, с повышенными правами/привилегиями). Подобно выполнению системного двоичного прокси, злоумышленники также злоупотребляют планированием задач для потенциальной маскировки однократного выполнения под доверенным системным процессом.



At
------------------------------------------------------------------------

Злоумышленники могут использовать утилиту at для планирования задач с целью первоначального или периодического выполнения вредоносного кода. Утилита at существует в виде исполняемого файла в Windows, Linux и macOS для планирования задач на указанное время и дату. Несмотря на то, что в средах Windows утилита at устарела в пользу функции schtasks из Scheduled Task, для ее использования необходимо, чтобы была запущена служба Task Scheduler, а пользователь входил в локальную группу Administrators.

В Linux и macOS at может вызываться суперпользователем, а также любыми пользователями, добавленными в файл at.allow. Если файл at.allow не существует, проверяется файл at.deny. Каждому имени пользователя, не указанному в at.deny, разрешается вызывать at. Если файл at.deny существует и пуст, глобальное использование at разрешено. Если ни один из файлов не существует (что часто бывает в базовой ситуации), только суперпользователю разрешено использовать at.

Злоумышленники могут использовать at для выполнения программ при запуске системы или по расписанию для обеспечения стойкости. at также может быть использован для удаленного выполнения в рамках латерального перемещения и/или для запуска процесса в контексте определенной учетной записи (например, SYSTEM).

В среде Linux злоумышленники могут также использовать at для выхода из ограниченного окружения, используя задачу для запуска интерактивной оболочки системы или для выполнения системных команд. Аналогично, at может использоваться для повышения привилегий, если двоичному файлу разрешено запускаться от имени суперпользователя через sudo.


Cron
------------------------------------------------------------------------

Злоумышленники могут использовать утилиту cron для планирования заданий для первоначального или периодического выполнения вредоносного кода. Утилита cron - это планировщик заданий на основе времени для Unix-подобных операционных систем. Файл crontab содержит расписание записей cron, которые должны быть запущены, и указанное время их выполнения. Все файлы crontab хранятся в специфических для операционной системы файловых путях.

Злоумышленник может использовать cron в средах Linux или Unix для выполнения программ при запуске системы или по расписанию для обеспечения стойкости.


Запланированная задача
------------------------------------------------------------------------

Злоумышленники могут использовать планировщик задач Windows для планирования задач с целью первоначального или периодического выполнения вредоносного кода. В Windows существует несколько способов доступа к планировщику задач. Утилиту schtasks можно запустить непосредственно из командной строки или открыть планировщик задач через графический интерфейс в разделе "Средства администратора" панели управления. В некоторых случаях злоумышленники использовали обертку .NET для планировщика задач Windows, а также библиотеку Windows netapi32 для создания запланированной задачи.

Устаревшая утилита at также может быть использована злоумышленниками (например, At), хотя at.exe не может получить доступ к задачам, созданным с помощью schtasks или панели управления.

Злоумышленники могут использовать планировщик задач Windows для выполнения программ при запуске системы или по расписанию для сохранения их в актуальном состоянии. Планировщик задач Windows также может быть использован для удаленного выполнения в рамках латерального перемещения и/или для запуска процесса в контексте определенной учетной записи (например, SYSTEM). Подобно выполнению системного двоичного прокси, злоумышленники также злоупотребляют планировщиком задач Windows для потенциальной маскировки однократного выполнения под подписанными/доверенными системными процессами.

Злоумышленники также могут создавать "скрытые" запланированные задачи (т. е. скрывать артефакты), которые могут быть не видны инструментам защитника и ручным запросам, используемым для перечисления задач. В частности, злоумышленник может скрыть задачу от schtasks /query и планировщика задач, удалив связанное с ней значение реестра Security Descriptor (SD) (при этом удаление этого значения должно быть выполнено с использованием прав SYSTEM). Для скрытия задач злоумышленники могут использовать и другие методы, например изменение метаданных (например, значения Index) в связанных ключах реестра.





Таймеры Systemd
------------------------------------------------------------------------

Злоумышленники могут использовать таймеры systemd для планирования задач с целью первоначального или периодического выполнения вредоносного кода. Таймеры Systemd - это файлы модулей с расширением .timer, которые управляют службами. Таймеры можно настроить на запуск по календарному событию или через промежуток времени относительно начальной точки. Они могут использоваться в качестве альтернативы Cron в средах Linux. Таймеры Systemd могут быть активированы удаленно с помощью утилиты командной строки systemctl, которая работает через SSH.

Каждый файл .timer должен иметь соответствующий файл .service с тем же именем, например, example.timer и example.service. Файлы .service - это файлы модулей служб Systemd, которые управляются менеджером систем и служб systemd. Привилегированные таймеры записываются в /etc/systemd/system/ и /usr/lib/systemd/system, а пользовательские - в ~/.config/systemd/user/.

Злоумышленник может использовать таймеры systemd для выполнения вредоносного кода при запуске системы или по расписанию для сохранения работоспособности. Таймеры, установленные по привилегированным путям, могут использоваться для сохранения работоспособности на уровне root. Злоумышленники также могут устанавливать таймеры на уровне пользователя, чтобы добиться постоянства на уровне пользователя.





Работа по оркестровке контейнеров
------------------------------------------------------------------------

Злоумышленники могут злоупотреблять функциями планирования задач, предоставляемыми средствами оркестровки контейнеров, такими как Kubernetes, для планирования развертывания контейнеров, настроенных на выполнение вредоносного кода. Задания оркестровки контейнеров запускают эти автоматические задачи в определенную дату и время, подобно заданиям cron в системе Linux. Развертывания такого типа также могут быть настроены на поддержание количества контейнеров в течение определенного времени, автоматизируя процесс поддержания постоянства в кластере.

В Kubernetes CronJob может использоваться для планирования задания, запускающего один или несколько контейнеров для выполнения определенных задач. Таким образом, злоумышленник может использовать CronJob для планирования развертывания задания, выполняющего вредоносный код на различных узлах кластера.